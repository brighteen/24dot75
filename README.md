# 📌 RAG 기반 챗봇 개발 로드맵 (Backend Team)

## 🚀 프로젝트 개요
이 프로젝트는 **학교 자료(수강신청, 장학금 안내문 등)를 기반으로 학생들에게 정확한 정보를 제공하는 RAG 기반 챗봇**을 개발하는 것이 목표입니다.  
이를 위해 **Parents Retriever**를 사용하여 문맥을 유지하고, **Hybrid Search(벡터 검색 + 키워드 검색)** 를 적용하여 검색 정확도를 높입니다.

---

## 📂 1. 문서 처리 단계 (Document Processing)
**📌 해야 할 일:** 문서를 업로드하고, Parents Retriever 방식으로 데이터를 저장할 준비를 합니다.

### ✅ 해야 할 작업
1. **학교 자료 수집** (PDF, DOCX, HWP 등)
   - 이미지 문서는 **OCR 적용 여부 고려** (Tesseract, AWS Textract 등 활용 가능)
2. **문서 분할 (Chunking)**
   - **Parent(큰 문서 단위)**: 1000~2000 토큰 크기로 설정  
   - **Child(세부 정보)**: 300~500 토큰 크기로 설정  
3. **문서를 임베딩 변환 후 DB에 저장**
   - OpenAI Embeddings를 사용하여 **문서를 벡터로 변환**  
   - **ChromaDB(벡터 검색용) & SQLite(키워드 검색용)에 저장**  

### 🔹 동작 과정
1. 문서를 Parent-Child 구조로 분할 후 저장
2. OpenAI Embeddings를 사용하여 문서를 벡터로 변환
3. **ChromaDB (벡터 검색용) & SQLite (키워드 검색용)에 저장**

---

## 🔍 2. 검색 단계 (Retrieval)
**📌 해야 할 일:** 사용자의 질문과 관련된 문서를 찾아서 제공하는 과정입니다.

### ✅ 해야 할 작업
1. **사용자의 질문 입력** → Parent 문서 검색
   - **벡터 검색(ChromaDB) & 키워드 검색(SQLite) 수행**
2. **검색된 Parent와 관련된 Child 문서도 함께 가져오기**
3. **최종적으로 필요한 문서를 선택하여 제공**

### 🔹 동작 과정
1. 사용자가 `"수강신청 마감일이 언제야?"` 라고 질문  
2. 키워드 검색(SQLite) → `"수강신청 안내문"` 검색  
3. 벡터 검색(ChromaDB) → `"수강신청 일정", "수강 정정 기간"` 포함된 Parent 문서 검색  
4. **Parent와 연결된 Child도 함께 검색하여 제공!**  

---

## 🧠 3. LLM 응답 생성 단계 (Answer Generation)
**📌 해야 할 일:** 검색된 문서를 바탕으로 GPT-4가 답변을 생성하는 과정입니다.

### ✅ 해야 할 작업
1. **프롬프트 최적화 (Query Rewriting 적용)**
   - "수강신청 언제야?" → `"2025년 1학기 수강신청 마감일은 언제인가?"`  
2. **검색된 문서를 기반으로 GPT-4가 최적의 응답 생성**
   - **할루시네이션 방지**를 위해 검색된 문서 내용만 사용하도록 설정

### 🔹 동작 과정
1. 사용자의 질문을 명확한 문장으로 변환 (Query Rewriting)
2. 검색된 문서를 기반으로 **GPT-4가 응답 생성**
3. 최종 답변을 사용자에게 제공

---

## 🔐 4. 사용자 관리 & 어드민 기능
**📌 해야 할 일:** 사용자 접근을 제한하고, 관리 기능을 추가하는 과정입니다.

### ✅ 해야 할 작업
1. **사용자 검색 제한**
   - **로그인 시스템 구축 (학생/관리자 계정)**
2. **어드민 기능 추가**
   - **문서 업로드 기능** → 새 문서 추가 시 자동으로 Parent-Child 변환  
   - **검색 로그 분석** → 학생들이 자주 검색하는 질문 확인

### 🔹 동작 과정
- 관리자가 새로운 문서를 업로드하면 자동으로 Parent-Child 변환 후 DB 저장
- 검색 로그를 기록하여 **자주 묻는 질문 분석 가능**

---

## 💻 5. UI 및 API 연동
**📌 해야 할 일:** 웹 인터페이스 또는 API 개발.

### ✅ 해야 할 작업
1. **웹 UI 또는 챗봇 인터페이스 개발**
   - 프론트엔드는 React 또는 Streamlit 등 선택 가능

---

## 🔥 최종 개발 순서 (순서대로 진행!)
✅ **1단계: 문서 수집 & 저장 (Parent-Child 구조 설정 & ChromaDB, SQLite 저장)**  
✅ **2단계: 검색 시스템 구축 (Ensemble Retriver, ParentDocumentRetiever, MultiQuery Retriever 적용)**  
✅ **3단계: LLM 응답 생성 (Query Rewriting 적용 & GPT-4 최적화)**  
✅ **4단계: 유저 관리 시스템 개발 (로그인, 검색 제한 설정)**  
✅ **5단계: 어드민 기능 추가 (문서 업로드 & 검색 로그 분석)**  
✅ **6단계: UI 개발 및 API 연동 (FastAPI/Flask + 프론트엔드 개발)**  

---

## 📌 기술 스택
| 구성 요소 | 기술 |
|-----------|--------------------|
| **벡터 데이터베이스** | ChromaDB |
| **임베딩 모델** | Upstage Embedding |
| **키워드 및 응답 저장 DB** | SQLite |
| **검색 방식** | Ensemble Retriver, ParentDocumentRetiever, MultiQuery Retriever (벡터 + 키워드 검색) |
| **프롬프트 최적화** | Query Rewriting |
| **유저 관리** | 로그인 시스템 + 검색 제한 |
| **프론트엔드** | Django 또는 Streamlit |

---

## 🎯 목표
- 학교 공식 문서를 기반으로 **정확한 정보를 제공하는 챗봇 개발**
- **할루시네이션(잘못된 정보 생성) 방지**
- **학생 및 교직원이 쉽게 사용할 수 있는 시스템 구축**

🚀 **시작이 반이다!** 🚀
